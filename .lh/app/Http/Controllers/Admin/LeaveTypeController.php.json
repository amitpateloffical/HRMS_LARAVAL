{
    "sourceFile": "app/Http/Controllers/Admin/LeaveTypeController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1714467389771,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1714467529836,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -81,20 +81,35 @@\n     //     $leave_type->delete();\r\n     //     storeActivityLog($userId=1, $action='Delete', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully deleted.');\r\n     //     return back()->with('success',\"Leave Type has been deleted successfully!!\");\r\n     // }\r\n-    public function destroy(Request $request)\r\n+//     public function destroy(Request $request)\r\n+// {\r\n+//     $leaveType = LeaveType::find($request->id);\r\n+\r\n+//     // Delete related leaves first\r\n+//     $leaveType->leaves()->delete();\r\n+\r\n+//     // Then delete the leave type\r\n+//     $leaveType->delete();\r\n+\r\n+//     storeActivityLog($userId = 1, $action = 'Delete', $description = $request->type, $moduleName = 'Leave', $moduleId = $request->id, $status = 'Leave has been successfully deleted.');\r\n+    \r\n+//     return back()->with('success', \"Leave Type has been deleted successfully!!\");\r\n+// }\r\n+public function destroy(Request $request)\r\n {\r\n-    $leaveType = LeaveType::find($request->id);\r\n+    $leaveTypeId = $request->id;\r\n \r\n-    // Delete related leaves first\r\n-    $leaveType->leaves()->delete();\r\n+    // Delete related leaves\r\n+    \\App\\Models\\Leave::where('leave_type_id', $leaveTypeId)->delete();\r\n \r\n     // Then delete the leave type\r\n-    $leaveType->delete();\r\n+    LeaveType::destroy($leaveTypeId);\r\n \r\n     storeActivityLog($userId = 1, $action = 'Delete', $description = $request->type, $moduleName = 'Leave', $moduleId = $request->id, $status = 'Leave has been successfully deleted.');\r\n     \r\n     return back()->with('success', \"Leave Type has been deleted successfully!!\");\r\n }\r\n \r\n+\r\n }\r\n"
                },
                {
                    "date": 1714467557839,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -74,42 +74,12 @@\n      *\r\n      * @param  int  $id\r\n      * @return \\Illuminate\\Http\\Response\r\n      */\r\n-    // public function destroy(Request $request)\r\n-    // {\r\n-    //     $leave_type = LeaveType::find($request->id);\r\n-    //     $leave_type->delete();\r\n-    //     storeActivityLog($userId=1, $action='Delete', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully deleted.');\r\n-    //     return back()->with('success',\"Leave Type has been deleted successfully!!\");\r\n-    // }\r\n-//     public function destroy(Request $request)\r\n-// {\r\n-//     $leaveType = LeaveType::find($request->id);\r\n-\r\n-//     // Delete related leaves first\r\n-//     $leaveType->leaves()->delete();\r\n-\r\n-//     // Then delete the leave type\r\n-//     $leaveType->delete();\r\n-\r\n-//     storeActivityLog($userId = 1, $action = 'Delete', $description = $request->type, $moduleName = 'Leave', $moduleId = $request->id, $status = 'Leave has been successfully deleted.');\r\n-    \r\n-//     return back()->with('success', \"Leave Type has been deleted successfully!!\");\r\n-// }\r\n-public function destroy(Request $request)\r\n-{\r\n-    $leaveTypeId = $request->id;\r\n-\r\n-    // Delete related leaves\r\n-    \\App\\Models\\Leave::where('leave_type_id', $leaveTypeId)->delete();\r\n-\r\n-    // Then delete the leave type\r\n-    LeaveType::destroy($leaveTypeId);\r\n-\r\n-    storeActivityLog($userId = 1, $action = 'Delete', $description = $request->type, $moduleName = 'Leave', $moduleId = $request->id, $status = 'Leave has been successfully deleted.');\r\n-    \r\n-    return back()->with('success', \"Leave Type has been deleted successfully!!\");\r\n+    public function destroy(Request $request)\r\n+    {\r\n+        $leave_type = LeaveType::find($request->id);\r\n+        $leave_type->delete();\r\n+        storeActivityLog($userId=1, $action='Delete', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully deleted.');\r\n+        return back()->with('success',\"Leave Type has been deleted successfully!!\");\r\n+    }\r\n }\r\n-\r\n-\r\n-}\r\n"
                },
                {
                    "date": 1714467661239,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -74,12 +74,31 @@\n      *\r\n      * @param  int  $id\r\n      * @return \\Illuminate\\Http\\Response\r\n      */\r\n+    // public function destroy(Request $request)\r\n+    // {\r\n+    //     $leave_type = LeaveType::find($request->id);\r\n+    //     $leave_type->delete();\r\n+    //     storeActivityLog($userId=1, $action='Delete', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully deleted.');\r\n+    //     return back()->with('success',\"Leave Type has been deleted successfully!!\");\r\n+    // }\r\n     public function destroy(Request $request)\r\n-    {\r\n-        $leave_type = LeaveType::find($request->id);\r\n-        $leave_type->delete();\r\n-        storeActivityLog($userId=1, $action='Delete', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully deleted.');\r\n-        return back()->with('success',\"Leave Type has been deleted successfully!!\");\r\n+{\r\n+    $leaveTypeId = $request->id;\r\n+\r\n+    // Check if there are any associated leaves\r\n+    $relatedLeaves = \\App\\Models\\Leave::where('leave_type_id', $leaveTypeId)->exists();\r\n+\r\n+    if ($relatedLeaves) {\r\n+        return back()->with('error', \"Cannot delete leave type. There are associated leaves.\");\r\n     }\r\n+\r\n+    // If no associated leaves, delete the leave type\r\n+    LeaveType::destroy($leaveTypeId);\r\n+\r\n+    storeActivityLog($userId = 1, $action = 'Delete', $description = $request->type, $moduleName = 'Leave', $moduleId = $request->id, $status = 'Leave has been successfully deleted.');\r\n+    \r\n+    return back()->with('success', \"Leave Type has been deleted successfully!!\");\r\n }\r\n+\r\n+}\r\n"
                },
                {
                    "date": 1714472801077,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -28,10 +28,10 @@\n      */\r\n     public function store(Request $request)\r\n     {\r\n         $this->validate($request,[\r\n-            'type'=>'required|max:255',\r\n-            'days'=>'required|numeric|integer|min:1'\r\n+            'type'=>'required|max:255'\r\n+            // 'days'=>'required|numeric|integer|min:1'\r\n         ]);\r\n         LeaveType::create($request->all());\r\n         storeActivityLog($userId=1, $action='store', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully added.');\r\n \r\n"
                },
                {
                    "date": 1714472824930,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -59,9 +59,9 @@\n     public function update(Request $request)\r\n     {\r\n         $this->validate($request,[\r\n             'type'=>'required|max:255',\r\n-            'days'=>'required|numeric|integer|min:1'\r\n+            // 'days'=>'required|numeric|integer|min:1'\r\n         ]);\r\n         $leave_type = LeaveType::find($request->id);\r\n         $leave_type->update($request->all());\r\n         storeActivityLog($userId=1, $action='Update', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully updated.');\r\n"
                },
                {
                    "date": 1714473035914,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n         $this->validate($request,[\r\n             'type'=>'required|max:255'\r\n             // 'days'=>'required|numeric|integer|min:1'\r\n         ]);\r\n-        LeaveType::create($request->all());\r\n+        LeaveType::create($request);\r\n         storeActivityLog($userId=1, $action='store', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully added.');\r\n \r\n         return back()->with('success',\"Leave type has been added\");\r\n     }\r\n"
                },
                {
                    "date": 1714473065877,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -31,9 +31,9 @@\n         $this->validate($request,[\r\n             'type'=>'required|max:255'\r\n             // 'days'=>'required|numeric|integer|min:1'\r\n         ]);\r\n-        LeaveType::create($request);\r\n+        LeaveType::create($request->all());\r\n         storeActivityLog($userId=1, $action='store', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully added.');\r\n \r\n         return back()->with('success',\"Leave type has been added\");\r\n     }\r\n"
                }
            ],
            "date": 1714467389771,
            "name": "Commit-0",
            "content": "<?php\r\n\r\nnamespace App\\Http\\Controllers\\Admin;\r\n\r\nuse App\\Models\\LeaveType;\r\nuse Illuminate\\Http\\Request;\r\nuse App\\Http\\Controllers\\Controller;\r\n\r\nclass LeaveTypeController extends Controller\r\n{\r\n    /**\r\n     * Display a listing of the resource.\r\n     *\r\n     * @return \\Illuminate\\Http\\Response\r\n     */\r\n    public function index()\r\n    {\r\n        $title = \"Leave Type\"; \r\n        $leave_types = LeaveType::get();\r\n        return view('backend.leave-type',compact('title','leave_types'));\r\n    }\r\n\r\n    /**\r\n     * Store a newly created resource in storage.\r\n     *\r\n     * @param  \\Illuminate\\Http\\Request  $request\r\n     * @return \\Illuminate\\Http\\Response\r\n     */\r\n    public function store(Request $request)\r\n    {\r\n        $this->validate($request,[\r\n            'type'=>'required|max:255',\r\n            'days'=>'required|numeric|integer|min:1'\r\n        ]);\r\n        LeaveType::create($request->all());\r\n        storeActivityLog($userId=1, $action='store', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully added.');\r\n\r\n        return back()->with('success',\"Leave type has been added\");\r\n    }\r\n\r\n    /**\r\n     * Display the specified resource.\r\n     *\r\n     * @param  int  $id\r\n     * @return \\Illuminate\\Http\\Response\r\n     */\r\n    public function show($id)\r\n    {\r\n        //\r\n    }\r\n\r\n    /**\r\n     * Update the specified resource in storage.\r\n     *\r\n     * @param  \\Illuminate\\Http\\Request  $request\r\n     * @param  int  $id\r\n     * @return \\Illuminate\\Http\\Response\r\n     */\r\n    public function update(Request $request)\r\n    {\r\n        $this->validate($request,[\r\n            'type'=>'required|max:255',\r\n            'days'=>'required|numeric|integer|min:1'\r\n        ]);\r\n        $leave_type = LeaveType::find($request->id);\r\n        $leave_type->update($request->all());\r\n        storeActivityLog($userId=1, $action='Update', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully updated.');\r\n\r\n        return back()->with('success',\"Leave type has been updated\");\r\n    }\r\n\r\n    /**\r\n     * Remove the specified resource from storage.\r\n     *\r\n     * @param  int  $id\r\n     * @return \\Illuminate\\Http\\Response\r\n     */\r\n    // public function destroy(Request $request)\r\n    // {\r\n    //     $leave_type = LeaveType::find($request->id);\r\n    //     $leave_type->delete();\r\n    //     storeActivityLog($userId=1, $action='Delete', $description=$request->type, $moduleName='Leave', $moduleId=$request->id,$status='Leave Has Been Successfully deleted.');\r\n    //     return back()->with('success',\"Leave Type has been deleted successfully!!\");\r\n    // }\r\n    public function destroy(Request $request)\r\n{\r\n    $leaveType = LeaveType::find($request->id);\r\n\r\n    // Delete related leaves first\r\n    $leaveType->leaves()->delete();\r\n\r\n    // Then delete the leave type\r\n    $leaveType->delete();\r\n\r\n    storeActivityLog($userId = 1, $action = 'Delete', $description = $request->type, $moduleName = 'Leave', $moduleId = $request->id, $status = 'Leave has been successfully deleted.');\r\n    \r\n    return back()->with('success', \"Leave Type has been deleted successfully!!\");\r\n}\r\n\r\n}\r\n"
        }
    ]
}